<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Clean Water Detector â€” Enhanced (Calm & Clean)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#eaf9ff; --accent:#4db8ff; --accent-dark:#045c9c; --text:#033e6b;
  --clean-blue:#3fb0ff; --dirty-red:#ff6b6b; --maybe-yellow:#f0c419;
  --fish-count:28; --caustics-opacity:0.18;
}

/* Reset & layout */
html,body{height:100%;margin:0;background:var(--bg);font-family:'Inter',sans-serif;color:var(--text);-webkit-font-smoothing:antialiased}
.container{max-width:980px;margin:32px auto;padding:0 20px;position:relative;z-index:6}
header{display:flex;align-items:center;gap:12px;justify-content:center;padding:28px 12px;background:rgba(255,255,255,0.92);border-radius:12px;box-shadow:0 6px 18px rgba(9,30,63,0.06);position:relative;z-index:6}
.logo{width:62px;height:62px;border-radius:14px;background:linear-gradient(135deg,var(--accent),#bfe9ff);display:flex;align-items:center;justify-content:center;font-size:28px;box-shadow:0 6px 14px rgba(0,0,0,0.06)}
.title{font-size:22px;font-weight:700;color:var(--accent-dark)}
nav{display:flex;justify-content:center;gap:26px;margin-top:14px}
nav a{color:var(--accent-dark);text-decoration:none;font-weight:600}
nav a:hover{text-decoration:underline}
section.card{background:#fff;border-radius:14px;padding:20px;margin-top:24px;box-shadow:0 8px 28px rgba(9,30,63,0.06)}
h2{color:var(--accent-dark);margin:0 0 10px 0}
.btn{background:var(--accent);color:white;border:none;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer;display:inline-flex;gap:10px;align-items:center}
.btn:active{transform:translateY(1px)}
#webcam-wrap{display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap}
#webcam-container{background:linear-gradient(180deg,#f8fdff,#ffffff);padding:12px;border-radius:10px;box-shadow:inset 0 1px 0 rgba(255,255,255,0.6)}
canvas{border-radius:8px;display:block}
#label-container div{font-size:16px;margin:6px 0}
.gauge-wrap{width:220px;height:140px;padding:6px;display:flex;flex-direction:column;align-items:center;justify-content:center}
.gauge{width:190px;height:110px}
.gauge .label{font-weight:700;margin-top:6px}
.facts{width:280px;padding:12px;border-radius:10px;background:linear-gradient(180deg,#f8ffff,#ffffff);box-shadow:0 6px 18px rgba(9,30,63,0.04)}
.fact-text{font-size:14px;min-height:56px;display:flex;align-items:center;justify-content:center;text-align:center;padding:6px;transition:opacity .35s ease}
.droplet{position:fixed;bottom:-40px;background:linear-gradient(180deg,rgba(255,255,255,0.85),rgba(180,230,255,0.35));width:14px;height:20px;border-radius:50% 50% 60% 60%;filter:blur(.3px);opacity:.85;z-index:2;pointer-events:none}

/* Background layers */
.bg-viewport{position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:0; display:block}
.caustics{position:absolute; inset:-10% -20% -10% -20%; z-index:0; mix-blend-mode:overlay;
  background-image:
    radial-gradient(circle at 20% 20%, rgba(255,255,255,0.12), transparent 12%),
    radial-gradient(circle at 80% 40%, rgba(255,255,255,0.08), transparent 10%),
    radial-gradient(circle at 60% 70%, rgba(255,255,255,0.06), transparent 12%);
  opacity:var(--caustics-opacity); transform:translateZ(0);
  animation:causticMove 18s linear infinite;
  filter: blur(10px) saturate(110%);
  will-change:transform;
}
.bg-fish-layer{position:absolute; inset:0; z-index:0; pointer-events:none; overflow:hidden}
.bg-bubble-layer{position:absolute; inset:0; z-index:0; pointer-events:none; overflow:visible}

/* fish & animation */
.fish{position:absolute; top:0; left:0; width:120px; height:auto; transform-origin:center; will-change:transform, opacity; backface-visibility:hidden; -webkit-backface-visibility:hidden; filter:drop-shadow(0 6px 10px rgba(5,36,52,0.06)); opacity:.95;}
.fish svg{ width:100%; height:auto; display:block; transform-origin:center center; }
@keyframes swimLR{0% { transform: translateX(-18vw) translateY(var(--y-offset)) rotateY(0deg) scale(var(--scale)); } 50% { transform: translateX(52vw) translateY(calc(var(--y-offset) + var(--bob))) rotateY(0deg) scale(var(--scale)); } 100% { transform: translateX(122vw) translateY(var(--y-offset)) rotateY(0deg) scale(var(--scale)); }}
@keyframes swimRL{0% { transform: translateX(122vw) translateY(var(--y-offset)) rotateY(180deg) scale(var(--scale)); } 50% { transform: translateX(52vw) translateY(calc(var(--y-offset) + var(--bob))) rotateY(180deg) scale(var(--scale)); } 100% { transform: translateX(-18vw) translateY(var(--y-offset)) rotateY(180deg) scale(var(--scale)); }}
.fish.anim-lr{ animation: swimLR var(--duration)s linear var(--delay)s infinite; }
.fish.anim-rl{ animation: swimRL var(--duration)s linear var(--delay)s infinite; }

/* extra wave overlay */
.bg-wave {
  position: fixed; inset: 0;
  background: repeating-linear-gradient(45deg, rgba(255,255,255,0.04), rgba(255,255,255,0.04) 10px, transparent 10px, transparent 20px);
  z-index:1;
  animation: waveMove 12s linear infinite;
}
@keyframes waveMove {0% { background-position:0 0; } 100% { background-position:100px 100px; }}

@media (max-width:880px){ :root{ --fish-count:18; --caustics-opacity:0.12; } .caustics{ animation-duration:26s; } }

/* ripple & droplets */
#ripple{position:fixed;width:140px;height:140px;border-radius:50%;pointer-events:none;background:radial-gradient(circle at 40% 30%, rgba(255,255,255,0.75), rgba(179,224,255,0.18));mix-blend-mode:screen;opacity:.68;transform:translate(-50%,-50%) scale(.85);transition:transform .12s linear;z-index:3}
</style>
</head>
<body>

<!-- Background layers -->
<div class="bg-viewport" aria-hidden="true">
  <div class="caustics" id="causticsLayer"></div>
  <div class="bg-fish-layer" id="fishLayer"></div>
  <div class="bg-bubble-layer" id="bubbleLayer"></div>
</div>
<div class="bg-wave" aria-hidden="true"></div>

<!-- ripple & droplets -->
<div class="droplet" style="left:8%;animation:rise 8s linear infinite;"></div>
<div class="droplet" style="left:18%;animation:rise 10s linear infinite;opacity:.9;"></div>
<div class="droplet" style="left:36%;animation:rise 7s linear infinite;opacity:.85;"></div>
<div class="droplet" style="left:58%;animation:rise 9s linear infinite;opacity:.8;"></div>
<div class="droplet" style="left:76%;animation:rise 11s linear infinite;opacity:.9;"></div>
<div id="ripple" aria-hidden="true"></div>

<div class="container" id="page-root">
  <header>
    <div class="logo" aria-hidden="true">ðŸ’§</div>
    <div>
      <div class="title">Clean Water Detector</div>
      <div style="font-size:12px;color:#2b5d82;margin-top:4px">Real-time water cleanliness classification</div>
    </div>
  </header>

  <nav style="margin-top:14px">
    <a href="#about">About</a> &nbsp;Â·&nbsp;
    <a href="#problem">Problem</a> &nbsp;Â·&nbsp;
    <a href="#beneficiaries">Who Benefits</a> &nbsp;Â·&nbsp;
    <a href="#instructions">Instructions</a> &nbsp;Â·&nbsp;
    <a href="#model">Model</a>
  </nav>

  <!-- About section -->
  <section class="card" id="about" style="display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap">
    <div style="flex:1;min-width:260px">
      <h2>About</h2>
      <p style="margin:8px 0 0 0">This demo uses a Teachable Machine image model to visually assess water samples. It is for demonstration and education only â€” not a certified lab test.</p>
    </div>
    <div class="facts" aria-live="polite">
      <div style="font-weight:700;margin-bottom:8px;color:var(--accent-dark);text-align:center">Water Knowledge</div>
      <div class="fact-text" id="fact-text">Loading tips & facts...</div>
      <div style="margin-top:8px;font-size:12px;text-align:center;color:#17607f">Tip: Use steady light and a plain background for best results.</div>
    </div>
  </section>

  <!-- Problem section -->
  <section class="card" id="problem">
    <h2>Problem: Water Filtration</h2>
    <p>Many communities around the world lack access to clean water. Contaminated water can carry harmful bacteria, chemicals, and pollutants, leading to serious health issues and environmental damage. Efficient water filtration is essential for safe drinking water and overall well-being.</p>
  </section>

  <!-- Beneficiaries section -->
  <section class="card" id="beneficiaries">
    <h2>Who Benefits</h2>
    <p>This technology can help students, researchers, environmental organizations, and households quickly check water clarity. It raises awareness about water quality and promotes safer water consumption for communities everywhere.</p>
  </section>

  <!-- Instructions -->
  <section class="card" id="instructions">
    <h2>Instructions</h2>
    <ul>
      <li>Click <button class="btn" id="start-btn-small">Start</button> to enable the camera.</li>
      <li>Hold the water sample steadily in view (good lighting helps).</li>
      <li>Click Stop to disable the camera when finished.</li>
    </ul>
  </section>

  <!-- Model section -->
  <section class="card" id="model">
    <h2>Run the Model</h2>
    <div id="webcam-wrap" style="display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap">
      <div id="webcam-container">
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn" id="start-btn">Start</button>
          <button class="btn" id="stop-btn" style="background:#bbb;color:#102">Stop</button>
          <button class="btn" id="retry-btn" style="background:transparent;color:var(--accent-dark);border:1px solid rgba(3,62,107,0.06);">Retry Model</button>
        </div>
        <div id="canvas-holder" style="margin-top:12px"></div>
        <div id="label-container" style="margin-top:10px" aria-live="polite"></div>
      </div>
      <div style="display:flex;flex-direction:column;gap:12px">
        <div class="gauge-wrap card" style="padding:12px;min-width:220px">
          <svg class="gauge" viewBox="0 0 200 100" aria-hidden="true">
            <path d="M 20 85 A 80 80 0 0 1 180 85" stroke="#ecf3fb" stroke-width="18" fill="none" stroke-linecap="round"/>
            <path id="gauge-arc" d="M 20 85 A 80 80 0 0 1 180 85" stroke="var(--clean-blue)" stroke-width="18" fill="none" stroke-linecap="round" stroke-dasharray="0 1000" transform="rotate(0 100 50)"/>
            <text id="gauge-percent" x="100" y="60" text-anchor="middle" font-size="22" font-weight="700" fill="#045c9c">--%</text>
          </svg>
          <div class="label" style="text-align:center;font-size:13px;color:#175d82">Water Quality</div>
        </div>

        <div style="display:flex;flex-direction:column;gap:8px">
          <div style="background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 20px rgba(9,30,63,0.04)">
            <div style="font-weight:700;color:var(--accent-dark);margin-bottom:6px">Model status</div>
            <div id="model-status" style="font-size:14px;color:#2b5d82">Waiting to start</div>
          </div>
          <div style="background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 20px rgba(9,30,63,0.04);min-width:220px">
            <div style="font-weight:700;color:var(--accent-dark);margin-bottom:6px">Quick tips</div>
            <ul style="margin:0;padding-left:18px;font-size:13px">
              <li>Use a plain background behind the sample.</li>
              <li>Keep camera steady and close to the water.</li>
              <li>Avoid strong reflections and glares.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- screen reader region -->
<div id="sr-results" aria-live="polite" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden"></div>

<!-- TensorFlow + Teachable Machine libs -->
<script defer src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<!-- Main script -->
<script defer>
(() => {
  'use strict';
  const MODEL_URL = './my_model/';
  const FACTS = [
    'ðŸ’§ Over 70% of Earth is water, but less than 1% is drinkable.',
    'ðŸŒ¿ Clean water is essential for health and agriculture.',
    'âš ï¸ Contaminated water causes millions of deaths yearly.',
    'ðŸ’¡ Use filtration and awareness to improve water safety.',
    'ðŸ§ª Small visual tests can help detect major impurities.'
  ];
  let model, webcam, maxPredictions;
  let factIdx=0;
  const factText=document.getElementById('fact-text');
  const modelStatus=document.getElementById('model-status');

  function nextFact(){ factText.style.opacity=0; setTimeout(()=>{
    factText.textContent=FACTS[factIdx]; factText.style.opacity=1;
    factIdx=(factIdx+1)%FACTS.length;
  },350); }
  setInterval(nextFact,5000); nextFact();

  async function initModel(){
    modelStatus.textContent='Loading model...';
    model = await tmImage.load(MODEL_URL + 'model.json', MODEL_URL + 'metadata.json');
    maxPredictions = model.getTotalClasses();
    modelStatus.textContent='Model ready';
  }

  async function initWebcam(){
    const flip=true;
    webcam = new tmImage.Webcam(300, 270, flip);
    await webcam.setup({ facingMode:'environment' });
    await webcam.play();
    document.getElementById('canvas-holder').appendChild(webcam.canvas);
    window.requestAnimationFrame(loop);
  }

  async function loop(){ webcam.update(); await predict(); window.requestAnimationFrame(loop); }

  async function predict(){
    if(!model) return;
    const prediction = await model.predict(webcam.canvas);
    const top = prediction.sort((a,b)=>b.probability-a.probability)[0];
    document.getElementById('label-container').innerHTML = prediction.map(p=>`<div>${p.className}: ${(p.probability*100).toFixed(1)}%</div>`).join('');
    document.getElementById('gauge-percent').textContent = (top.probability*100).toFixed(0) + '%';
    document.getElementById('gauge-arc').setAttribute('stroke-dasharray', (top.probability*502)+' 502');
  }

  document.getElementById('start-btn').addEventListener('click',async()=>{await initModel(); await initWebcam();});
  document.getElementById('start-btn-small').addEventListener('click',()=>document.getElementById('start-btn').click());
  document.getElementById('stop-btn').addEventListener('click',()=>{if(webcam){webcam.stop(); webcam.canvas.remove(); webcam=null; modelStatus.textContent='Stopped';}});
})();
</script>
</body>
</html>
